## 组件的三大特性

1. 自定义标签
2. 组件有自己的属性和标签
3. 组件插槽 web component

## 声明一个组件

### 1. 全局组件

任意一个 Vue 的实例都可以访问到的组件,可以在任意实例的模板中使用
通过 Vue.component("组件名称"，组件的配置项);

```js
Vue.component("my-button", {
  template: "<button>点我啊</button>",
});

const vm1 = new Vue({
  el: "#app",
  data() {
    return {
      name: "lilei",
    };
  },
});
```

### 2. 局部组件

通过组件的 components 选项注入组件

```js
const vm = new Vue({
  el: "#app",
  data() {
    return {
      name: "李雷",
      age: 18,
    };
  },
  components: {
    /* 
        key是组件名称可以在当前组件的模板中使用
        value是该组件的配置对象，如果在单文件组件中就是默认导出的options对象
        */
    "my-button": {
      template: "<button>inner button</button>",
    },
  },
});
```

## 组件继承的关系

优先找局部组件，找不到再找全局组件
不管是全局的组件还是局部的组件，配置对象其实都在内部调用了 Vue.extend 方法

```js
// 全局
Vue.component(
  "my-button",
  Vue.extend({
    template: "<button>点我啊</button>",
  })
);

// 局部
components: {
    /*
        key是组件名称可以在当前组件的模板中使用
        value是该组件的配置对象，如果在单文件组件中就是默认导出的options对象
        */
    "my-button": Vue.extend({
      template: "<button>inner button</button>",
    }),
  },
```

声明一个组件的本质就是创建了一个 Vue 这个类的子类
而用什么来创造呢？Vue 给我们提供了 Vue.extend 的 API 来创建一个 Vue 的子类
然后我们 new 这个创建出来的子类 得到一个实例对象
调用这个实例对象上的$mount 方法 可以将组件的模板挂载到 el 属性指向的 DOM 元素上，并且组件中的 data 和模板视图是响应式的

```js
/* 
    Vue.extend( options )
    使用基础 Vue 构造器，创建一个“子类”。参数是一个包含组件选项的对象。
    data 选项是特例，需要注意 - 在 Vue.extend() 中它必须是函数
*/

<div id="mount-point"></div>;

// 创建构造器
var Profile = Vue.extend({
  template: "<p>{{firstName}} {{lastName}} aka {{alias}}</p>",
  data: function () {
    return {
      firstName: "Walter",
      lastName: "White",
      alias: "Heisenberg",
    };
  },
});
// 创建 Profile 实例，并挂载到一个元素上。
new Profile().$mount("#mount-point");
```

## Vue.extend 的原理
1. 执行此方法会返回一个Vue的子类，基于继承Object.create实现的
2. new这个子类又会执行实例的_init方法 也就是Vue的初始化方法 基于原型链可以调用 返回一个Sub类的实例
3. 如果这个Sub类的实例又去调用$mount 此时就会创建一个子组件的渲染Watcher 执行后续渲染逻辑
```js
Vue.extend = function (options) {
  function Sub(options = {}) {
    this._init(options);
  }
  Sub.prototype = Object.create(Vue.prototype);
  Sub.prototype.constructor = Sub;
  // 保存用户传递的options，便于在mergeOptions时方便的取到options
  Sub.options = options;

  return Sub;
};
```
先通过Vue.extend 返回一个Vue的子类
然后new这个子类产生一个组件实例，new的过程中会完成参数options的合并以及状态的初始化
然后手动调用$mount传入选择器实现手动挂载
$mount中会读取进行模板编译，返回render函数，这个过程会完成属性的依赖收集
调用mountComponent方法实现组件挂载
此时又会生成一个渲染watcher  new Watcher(vm,updateComponent,true);
this.getter.call(this.vm); getter就是updateComponent
执行getter就会执行render函数生成虚拟DOM，然后执行update方法实现patch挂载即视图渲染

## mergeOptions
第一个参数是挂载在Sub或者Vue类上的options，也就是调用Vue.extend时传入的options
第二个参数是new 这个类的时候传入的自定义options，可以为空